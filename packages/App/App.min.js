/**
 * marionette.toolkit - A collection of opinionated Backbone.Marionette extensions for large scale application architecture.
 * @version v0.4.0
 * @link https://github.com/RoundingWellOS/marionette.toolkit
 * @license MIT
 */
"use strict";var _=require("underscore"),Marionette=require("backbone.marionette"),StateClass=require("marionette.toolkit.state-class"),AbstractApp=StateClass.extend({_isRunning:!1,_isDestroyed:!1,preventDestroy:!1,startAfterInitialized:!1,startWithParent:!1,stopWithParent:!0,constructor:function(t){t=t||{},_.bindAll(this,"start","stop");var e=["startWithParent","stopWithParent","startAfterInitialized","preventDestroy"];_.extend(this,_.pick(t,e)),StateClass.call(this,t),_.result(this,"startAfterInitialized")&&this.start(t)},_ensureAppIsIntact:function(){if(this._isDestroyed)throw new Marionette.Error({name:"AppDestroyedError",message:"App has already been destroyed and cannot be used."})},isRunning:function(){return this._isRunning},start:function(t){return this._ensureAppIsIntact(),this._isRunning?this:(this.triggerMethod("before:start",t),this._isRunning=!0,this.triggerStart(t),this)},triggerStart:function(t){this.triggerMethod("start",t)},stop:function(t){return this._isRunning?(this.triggerMethod("before:stop",t),this._isRunning=!1,this.triggerMethod("stop",t),this._stopRunningListeners(),this._stopRunningEvents(),this):this},isDestroyed:function(){return this._isDestroyed},destroy:function(){this._isDestroyed||(this._isDestroyed=!0,this.stop(),StateClass.prototype.destroy.apply(this,arguments))},_stopRunningEvents:function(){_.each(this._runningEvents,function(t){this.off.apply(this,t)},this)},_stopRunningListeners:function(){_.each(this._runningListeningTo,function(t){this.stopListening.apply(this,t)},this)},on:function(){return this._isRunning&&(this._runningEvents=this._runningEvents||[],this._runningEvents.push(arguments)),StateClass.prototype.on.apply(this,arguments)},listenTo:function(){return this._isRunning&&(this._runningListeningTo=this._runningListeningTo||[],this._runningListeningTo.push(arguments)),StateClass.prototype.listenTo.apply(this,arguments)},listenToOnce:function(){return this._isRunning&&(this._runningListeningTo=this._runningListeningTo||[],this._runningListeningTo.push(arguments)),StateClass.prototype.listenToOnce.apply(this,arguments)}}),abstract_app=AbstractApp,App=abstract_app.extend({constructor:function(t){t=t||{},this._childApps={},_.extend(this,_.pick(t,["childApps"])),this._initChildApps(t),this.on({start:this._startChildApps,"before:stop":this._stopChildApps,"before:destroy":this._destroyChildApps}),abstract_app.call(this,t)},_initChildApps:function(t){var e=this.childApps;e&&(_.isFunction(e)&&(e=e.call(this,t)),this.addChildApps(e))},_startChildApps:function(){_.each(this._childApps,function(t){_.result(t,"startWithParent")&&t.start()})},_stopChildApps:function(){_.each(this._childApps,function(t){_.result(t,"stopWithParent")&&t.stop()})},_destroyChildApps:function(){_.each(this._childApps,function(t){_.result(t,"preventDestroy")||t.destroy()})},_buildAppFromObject:function(t){var e=t.AppClass,i=_.omit(t,"AppClass");return this.buildApp(e,i)},_buildApp:function(t,e){return _.isFunction(t)?this.buildApp(t,e):_.isObject(t)?this._buildAppFromObject(t):void 0},buildApp:function(t,e){return new t(e)},_ensureAppIsUnique:function(t){if(this._childApps[t])throw new Marionette.Error({name:"DuplicateChildAppError",message:'A child App with name "'+t+'" has already been added.'})},addChildApps:function(t){_.each(t,function(t,e){this.addChildApp(e,t)},this)},addChildApp:function(t,e,i){this._ensureAppIsUnique(t);var s=this._buildApp(e,i);if(!s)throw new Marionette.Error({name:"AddChildAppError",message:"App build failed.  Incorrect configuration."});return s._name=t,this._childApps[t]=s,s.on("destroy",_.partial(this._removeChildApp,t),this),this.isRunning()&&_.result(s,"startWithParent")&&s.start(),s},getName:function(){return this._name},getChildApps:function(){return _.clone(this._childApps)},getChildApp:function(t){return this._childApps[t]},_removeChildApp:function(t){delete this._childApps[t]._name,delete this._childApps[t]},removeChildApps:function(){var t=this.getChildApps();return _.each(this._childApps,function(t,e){this.removeChildApp(e)},this),t},removeChildApp:function(t,e){e=e||{};var i=this.getChildApp(t);if(i)return e.preventDestroy||_.result(i,"preventDestroy")?this._removeChildApp(t):i.destroy(),i}}),app=App;module.exports=app;
//# sourceMappingURL=App.min.js.map