{"version":3,"sources":["App.js"],"names":[],"mappings":"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","file":"App.js","sourcesContent":["/**\n * marionette.toolkit - A collection of opinionated Backbone.Marionette extensions for large scale application architecture.\n * @version v0.4.0\n * @link https://github.com/RoundingWellOS/marionette.toolkit\n * @license MIT\n */\n'use strict';\n\nvar _ = require('underscore');\nvar Marionette = require('backbone.marionette');\nvar StateClass = require('marionette.toolkit.state-class');\n\nvar AbstractApp = StateClass.extend({\n\n  /**\n   * Internal flag indiciate when `App` has started but has not yet stopped.\n   *\n   * @private\n   * @type {Boolean}\n   * @default false\n   */\n  _isRunning: false,\n\n  /**\n   * Internal flag indiciate when `App` has been destroyed\n   *\n   * @private\n   * @type {Boolean}\n   * @default false\n   */\n  _isDestroyed: false,\n\n  /**\n   * Set to true if a parent `App` should not be able to destroy this `App`.\n   *\n   * @type {Boolean|Function}\n   * @default false\n   */\n  preventDestroy: false,\n\n  /**\n   * Set to true if `App` should be started after it is initialized.\n   *\n   * @type {Boolean|Function}\n   * @default false\n   */\n  startAfterInitialized: false,\n\n  /**\n   * Set to true if `App` should be started after its parent starts.\n   *\n   * @type {Boolean|Function}\n   * @default false\n   */\n  startWithParent: false,\n\n  /**\n   * Set to false if `App` should not stop after its parent stops.\n   *\n   * @type {Boolean|Function}\n   * @default true\n   */\n  stopWithParent: true,\n\n  /**\n   * @public\n   * @constructs AbstractApp\n   * @param {Object} [options] - Settings for the App.\n   * @param {Boolean} [options.startWithParent]\n   * @param {Boolean} [options.stopWithParent]\n   * @param {Boolean} [options.startAfterInitialized]\n   * @param {Boolean} [options.preventDestroy]\n   */\n  constructor: function(options) {\n    options = options || {};\n\n    _.bindAll(this, 'start', 'stop');\n\n    var pickOptions = [\n      'startWithParent',\n      'stopWithParent',\n      'startAfterInitialized',\n      'preventDestroy'\n    ];\n\n    _.extend(this, _.pick(options, pickOptions));\n\n    // Will call initialize\n    StateClass.call(this, options);\n\n    if(_.result(this, 'startAfterInitialized')) {\n      this.start(options);\n    }\n  },\n\n  /**\n   * Internal helper to verify if `App` has been destroyed\n   *\n   * @private\n   * @method _ensureAppIsIntact\n   * @memberOf AbstractApp\n   * @throws AppDestroyedError - Thrown if `App` has already been destroyed\n   */\n  _ensureAppIsIntact: function() {\n    if(this._isDestroyed) {\n      throw new Marionette.Error({\n        name: 'AppDestroyedError',\n        message: 'App has already been destroyed and cannot be used.'\n      });\n    }\n  },\n\n  /**\n   * Gets the value of internal `_isRunning` flag\n   *\n   * @public\n   * @method isRunning\n   * @memberOf AbstractApp\n   * @returns {Boolean}\n   */\n  isRunning: function() {\n    return this._isRunning;\n  },\n\n  /**\n   * Sets the app lifecycle to running.\n   *\n   * @public\n   * @method start\n   * @memberOf AbstractApp\n   * @param {Object} [options] - Settings for the App passed through to events\n   * @event AbstractApp#before:start - passes options\n   * @returns {AbstractApp}\n   */\n  start: function(options) {\n    this._ensureAppIsIntact();\n\n    if(this._isRunning) {\n      return this;\n    }\n\n    this.triggerMethod('before:start', options);\n\n    this._isRunning = true;\n\n    this.triggerStart(options);\n\n    return this;\n  },\n\n  /**\n   * Triggers start event.\n   * Override to introduce async start\n   *\n   * @public\n   * @method triggerStart\n   * @memberOf AbstractApp\n   * @param {Object} [options] - Settings for the App passed through to events\n   * @event AbstractApp#start - passes options\n   * @returns\n   */\n  triggerStart: function(options) {\n    this.triggerMethod('start', options);\n  },\n\n  /**\n   * Sets the app lifecycle to not running.\n   * Removes any listeners added during the running state\n   *\n   * @public\n   * @method stop\n   * @memberOf AbstractApp\n   * @param {Object} [options] - Settings for the App passed through to events\n   * @event AbstractApp#before:stop - passes options\n   * @event AbstractApp#stop - passes options\n   * @returns {AbstractApp}\n   */\n  stop: function(options) {\n    if(!this._isRunning) {\n      return this;\n    }\n\n    this.triggerMethod('before:stop', options);\n\n    this._isRunning = false;\n\n    this.triggerMethod('stop', options);\n\n    this._stopRunningListeners();\n    this._stopRunningEvents();\n\n    return this;\n  },\n\n  /**\n   * Gets the value of internal `_isDestroyed` flag\n   *\n   * @public\n   * @method isDestroyed\n   * @memberOf AbstractApp\n   * @returns {Boolean}\n   */\n  isDestroyed: function() {\n    return this._isDestroyed;\n  },\n\n  /**\n   * Stops the `App` and sets it destroyed.\n   *\n   * @public\n   * @method destroy\n   * @memberOf AbstractApp\n   */\n  destroy: function() {\n    if(this._isDestroyed) {\n      return;\n    }\n\n    this._isDestroyed = true;\n\n    this.stop();\n\n    StateClass.prototype.destroy.apply(this, arguments);\n  },\n\n  /**\n   * Internal method to stop any registered events.\n   *\n   * @private\n   * @method _stopRunningEvents\n   * @memberOf AbstractApp\n   */\n  _stopRunningEvents: function(){\n    _.each(this._runningEvents, function(args) {\n      this.off.apply(this, args);\n    }, this);\n  },\n\n  /**\n   * Internal method to stop any registered listeners.\n   *\n   * @private\n   * @method _stopRunningListeners\n   * @memberOf AbstractApp\n   */\n  _stopRunningListeners: function(){\n    _.each(this._runningListeningTo, function(args) {\n      this.stopListening.apply(this, args);\n    }, this);\n  },\n\n  /**\n   * Overrides `Backbone.Event.on()`\n   * If this `App` is running it will register the event for removal `onStop`\n   *\n   * @public\n   * @method on\n   * @memberOf AbstractApp\n   * @returns {AbstractApp}\n   */\n  on: function() {\n    if(this._isRunning) {\n      this._runningEvents = (this._runningEvents || []);\n      this._runningEvents.push(arguments);\n    }\n    return StateClass.prototype.on.apply(this, arguments);\n  },\n\n  /**\n   * Overrides `Backbone.Event.listenTo()`\n   * If this `App` is running it will register the listener for removal `onStop`\n   *\n   * @public\n   * @method listenTo\n   * @memberOf AbstractApp\n   * @returns {AbstractApp}\n   */\n  listenTo: function() {\n    if(this._isRunning) {\n      this._runningListeningTo = (this._runningListeningTo || []);\n      this._runningListeningTo.push(arguments);\n    }\n    return StateClass.prototype.listenTo.apply(this, arguments);\n  },\n\n  /**\n   * Overrides `Backbone.Event.listenToOnce()`\n   * If this `App` is running it will register the listener for removal `onStop`\n   *\n   * @public\n   * @method listenToOnce\n   * @memberOf AbstractApp\n   * @returns {AbstractApp}\n   */\n  listenToOnce: function(){\n    if(this._isRunning) {\n      this._runningListeningTo = (this._runningListeningTo || []);\n      this._runningListeningTo.push(arguments);\n    }\n\n    return StateClass.prototype.listenToOnce.apply(this, arguments);\n  }\n});\n\nvar abstract_app = AbstractApp;\n\nvar App = abstract_app.extend({\n\n  /**\n   * @public\n   * @constructs App\n   * @param {Object} [options] - Settings for the App.\n   * @param {Object} [options.childApps] - Hash for setting up child apps.\n   *\n   * ```js\n   * childApps: {\n   *   appName: {\n   *     AppClass: MyChildAppClass,\n   *     fooOption: true,\n   *     startWithParent: true\n   *   },\n   *   barApp: MyOtherChildAppClass\n   * }\n   * ```\n   */\n  constructor: function(options) {\n    options = options || {};\n\n    this._childApps = {};\n\n    _.extend(this, _.pick(options, ['childApps']));\n\n    this._initChildApps(options);\n\n    // The child apps should be handled while the app is running;\n    // After start, before stop, and before destroy.\n    this.on({\n      'start'          : this._startChildApps,\n      'before:stop'    : this._stopChildApps,\n      'before:destroy' : this._destroyChildApps\n    });\n\n    abstract_app.call(this, options);\n  },\n\n  /**\n   * Initializes `childApps` option\n   *\n   * @private\n   * @method _initChildApps\n   * @memberOf App\n   */\n  _initChildApps: function(options) {\n    var childApps = this.childApps;\n\n    if(childApps) {\n\n      if(_.isFunction(childApps)) {\n        childApps = childApps.call(this, options);\n      }\n\n      this.addChildApps(childApps);\n    }\n  },\n\n  /**\n   * Starts `childApps` if allowed by child\n   *\n   * @private\n   * @method _startChildApps\n   * @memberOf App\n   */\n  _startChildApps: function() {\n    _.each(this._childApps, function(childApp) {\n      if(_.result(childApp, 'startWithParent')) {\n        childApp.start();\n      }\n    });\n  },\n\n  /**\n   * Stops `childApps` if allowed by child\n   *\n   * @private\n   * @method _stopChildApps\n   * @memberOf App\n   */\n  _stopChildApps: function() {\n    _.each(this._childApps, function(childApp) {\n      if(_.result(childApp, 'stopWithParent')) {\n        childApp.stop();\n      }\n    });\n  },\n\n  /**\n   * Destroys `childApps` if allowed by child\n   *\n   * @private\n   * @method _destroyChildApps\n   * @memberOf App\n   */\n  _destroyChildApps: function() {\n    _.each(this._childApps, function(childApp) {\n      if(!_.result(childApp, 'preventDestroy')) {\n        childApp.destroy();\n      }\n    });\n  },\n\n  /**\n   * Internal helper to instantiate and `App` from on `Object`\n   *\n   * @private\n   * @method _buildAppFromObject\n   * @memberOf App\n   * @param {Object} appConfig - `AppClass` and any other option for the `App`\n   * @returns {App}\n   */\n  _buildAppFromObject: function(appConfig) {\n    var AppClass = appConfig.AppClass;\n    var options = _.omit(appConfig, 'AppClass');\n\n    return this.buildApp(AppClass, options);\n  },\n\n  /**\n   * Helper for building an App and return it\n   *\n   * @private\n   * @method _buildApp\n   * @memberOf App\n   * @param {App} AppClass - An App Class\n   * @param {Object} AppClass - Optionally passed as an appConfig Object\n   * @param {Object} [options] - options for the AppClass\n   * @returns {App}\n   */\n  _buildApp: function(AppClass, options) {\n    if(_.isFunction(AppClass)) {\n      return this.buildApp(AppClass, options);\n    }\n    if(_.isObject(AppClass)) {\n      return this._buildAppFromObject(AppClass);\n    }\n  },\n\n  /**\n   * Build an App and return it\n   * Override for dynamic App building\n   *\n   * @public\n   * @method buildApp\n   * @memberOf App\n   * @param {App} [AppClass] - An App Class\n   * @param {Object} [options] - options for the AppClass\n   * @returns {App}\n   */\n  buildApp: function(AppClass, options) {\n    return new AppClass(options);\n  },\n\n  /**\n   * Internal helper to verify `appName` is unique and not in use\n   *\n   * @private\n   * @method _ensureAppIsUnique\n   * @memberOf App\n   * @param {String} appName - Name of app to test\n   * @throws DuplicateChildAppError - Thrown if `App` already has an `appName` registered\n   */\n  _ensureAppIsUnique: function(appName) {\n    if(this._childApps[appName]) {\n      throw new Marionette.Error({\n        name: 'DuplicateChildAppError',\n        message: 'A child App with name \"' + appName + '\" has already been added.'\n      });\n    }\n  },\n\n  /**\n   * Add child `App`s to this `App`\n   *\n   * @public\n   * @method addChildApps\n   * @memberOf App\n   * @param {Object} childApps - Hash of names and `AppClass` or `appConfig`\n   */\n  addChildApps: function(childApps) {\n    _.each(childApps, function(childApp, appName) {\n      this.addChildApp(appName, childApp);\n    }, this);\n  },\n\n  /**\n   * Build's childApp and registers it with this App\n   * Starts the childApp, if this app is running and child is `startWithParent`\n   *\n   * @public\n   * @method addChildApp\n   * @memberOf App\n   * @param {String} appName - Name of App to register\n   * @param {App} AppClass - An App Class\n   * @param {Object} AppClass - Optionally passed as an appConfig Object\n   * @param {Object} [options] - options for the AppClass\n   * @throws AddChildAppError - Thrown if no childApp could be built from params\n   * @returns {App}\n   */\n  addChildApp: function(appName, AppClass, options) {\n    this._ensureAppIsUnique(appName);\n\n    var childApp = this._buildApp(AppClass, options);\n\n    if(!childApp){\n      throw new Marionette.Error({\n        name: 'AddChildAppError',\n        message: 'App build failed.  Incorrect configuration.'\n      });\n    }\n\n    childApp._name = appName;\n\n    this._childApps[appName] = childApp;\n\n    // When the app is destroyed remove the cached app.\n    childApp.on('destroy', _.partial(this._removeChildApp, appName), this);\n\n    if(this.isRunning() && _.result(childApp, 'startWithParent')) {\n      childApp.start();\n    }\n\n    return childApp;\n  },\n\n  /**\n   * Returns registered child `App`s name\n   *\n   * @public\n   * @method getName\n   * @memberOf App\n   * @returns {String}\n   */\n  getName: function() {\n    return this._name;\n  },\n\n\n  /**\n   * Returns registered child `App`s array\n   *\n   * @public\n   * @method getChildApps\n   * @memberOf App\n   * @returns {Array}\n   */\n  getChildApps: function(){\n    return _.clone(this._childApps);\n  },\n\n  /**\n   * Returns registered child `App`\n   *\n   * @public\n   * @method getChildApp\n   * @memberOf App\n   * @param {String} appName - Name of App to retrieve\n   * @returns {App}\n   */\n  getChildApp: function(appName) {\n    return this._childApps[appName];\n  },\n\n  /**\n   * Internal helper.  Unregisters child `App`\n   *\n   * @private\n   * @method _removeChildApp\n   * @memberOf App\n   * @param {String} appName - Name of App to unregister\n   * @returns {App}\n   */\n  _removeChildApp: function(appName) {\n    delete this._childApps[appName]._name;\n    delete this._childApps[appName];\n  },\n\n  /**\n   * Removes all childApps and returns them.\n   * The return is useful if any app is using `preventDestroy`\n   *\n   * @public\n   * @method removeChildApps\n   * @memberOf App\n   * @returns {Array}\n   */\n  removeChildApps: function(){\n    var childApps = this.getChildApps();\n\n    _.each(this._childApps, function(childApp, appName) {\n      this.removeChildApp(appName);\n    }, this);\n\n    return childApps;\n  },\n\n  /**\n   * Destroys or removes registered child `App` by name\n   * depending on `preventDestroy`\n   *\n   * @public\n   * @method removeChildApp\n   * @memberOf App\n   * @param {String} appName - Name of App to destroy\n   * @param {Object} [options.preventDestroy] - Flag to remove but prevent App destroy\n   * @returns {App}\n   */\n  removeChildApp: function(appName, options) {\n    options = options || {};\n\n    var childApp = this.getChildApp(appName);\n\n    if(!childApp) {\n      return;\n    }\n\n    // if preventDestroy simply unregister the child app\n    if(options.preventDestroy || _.result(childApp, 'preventDestroy')) {\n      this._removeChildApp(appName);\n    } else {\n      childApp.destroy();\n    }\n\n    return childApp;\n  }\n\n});\n\nvar app = App;\n\nmodule.exports = app;\n"],"sourceRoot":"/source/"}